

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial: Resource estimation with PyGSLIB &mdash; PyGSLIB 0.0.0.3.8 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/Opengeostat_fav.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PyGSLIB 0.0.0.3.8 documentation" href="index.html"/>
        <link rel="next" title="PyGSLIB API autogenerated documentation!" href="API.html"/>
        <link rel="prev" title="Welcome to PyGSLIB documentation!" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> PyGSLIB
          

          
          </a>

          
            
            
              <div class="version">
                0.0.0.3.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial: Resource estimation with PyGSLIB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preliminaries">Preliminaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-python-packages">Loading python packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-the-drillhole-tables">Loading the drillhole tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-drillhole-object">Creating drillhole object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compositing">Compositing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#desurveying">Desurveying</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-bhid-of-type-integer">Creating a BHID of type integer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rendering-drillhole-intervals-in-paraview-and-exporting-drillhole-data">Rendering drillhole intervals in Paraview and exporting drillhole data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tagging-samples-with-domain-code">Tagging samples with domain code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#block-modeling">Block modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#some-basic-stats">Some basic stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="#estimating-cu-grade-in-one-block">Estimating Cu grade in one block</a></li>
<li class="toctree-l2"><a class="reference internal" href="#estimating-in-all-blocks">Estimating in all blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#validating-the-results">Validating the results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="API.html">PyGSLIB API autogenerated documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html#indices-and-tables">Indices and tables</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">PyGSLIB</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Tutorial: Resource estimation with PyGSLIB</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Tutorial.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial-resource-estimation-with-pygslib">
<h1>Tutorial: Resource estimation with PyGSLIB<a class="headerlink" href="#tutorial-resource-estimation-with-pygslib" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will guide you on doing resource estimation with PyGSLIB. The informing data is from the <a class="reference external" href="http://www.nrri.umn.edu/egg/REPORTS/TR200321/TR200321.html">BABBITT zone of the
KEWEENAWAN DULUTH
COMPLEX</a>.</p>
<p>The sequence of data preparation and estimation used in this example is
as follows:</p>
<ul class="simple">
<li>import drillhole tables</li>
<li>create a drillhole object</li>
<li>composite drillhole intervals</li>
<li>desurvey drillholes</li>
<li>code drillholes with domains</li>
<li>declustering and basic statistics</li>
<li>create a block model</li>
<li>populate a wireframe domain with blocks</li>
<li>estimate with ordinary kriging</li>
<li>basic model validation</li>
</ul>
<p>To run this demo in your computer download and unpack <a class="reference external" href="_files/PyGSLIB_Tutorial1.zip">the demo
files</a>. If you have issues installing
PyGSLIB <a class="reference external" href="https://www.youtube.com/watch?v=cbWXi7BfZVg">follow this
tutorial</a></p>
<div class="section" id="preliminaries">
<h2>Preliminaries<a class="headerlink" href="#preliminaries" title="Permalink to this headline">¶</a></h2>
<p>To follow this tutorial you may be familiar with:</p>
<ul class="simple">
<li>Python 2.7</li>
<li>Python Data Analysis Library (Pandas). PyGSLIB was designed to work
with Pandas.</li>
<li>Numpy</li>
<li>Matplotlib</li>
<li>Paraview, an open-source, multi-platform data analysis and
visualization application</li>
<li>GSLIB, geostatistics and mineral resource estimation</li>
</ul>
</div>
<div class="section" id="loading-python-packages">
<h2>Loading python packages<a class="headerlink" href="#loading-python-packages" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># import third party python libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># make plots inline</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># import pygslib</span>
<span class="kn">import</span> <span class="nn">pygslib</span>
</pre></div>
</div>
<p>Need some help? Just type</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">__doc__</span>
</pre></div>
</div>
<p>or go to <a class="reference external" href="https://opengeostat.github.io/pygslib/">the PyGSLIB online
manual</a></p>
</div>
<div class="section" id="loading-the-drillhole-tables">
<h2>Loading the drillhole tables<a class="headerlink" href="#loading-the-drillhole-tables" title="Permalink to this headline">¶</a></h2>
<p>PyGSLIB only understands drillholes tables loaded into Pandas
DataFrames. Two tables are compulsory:</p>
<ul class="simple">
<li>the collar, with the compulsory fields <em>BHID</em>, <em>XCOLLAR</em>, <em>YCOLLAR</em> and <em>ZCOLLAR</em> and the optional field <em>LENGTH</em></li>
<li>and survey, with the compulsory fields <em>BHID</em>, <em>AT</em>, <em>AZ</em>, <em>DIP</em></li>
</ul>
<p>In addition, you may have any number of optional interval tables with
the compulsory fields <em>BHID</em>, <em>FROM</em> and <em>TO</em></p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># importing data from file</span>
<span class="n">collar</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;collar_BABBITT.csv&#39;</span><span class="p">)</span>
<span class="n">survey</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;survey_BABBITT.csv&#39;</span><span class="p">)</span>
<span class="n">assay</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;assay_BABBITT.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">collar</span></code>, <code class="docutils literal"><span class="pre">survey</span></code> and <code class="docutils literal"><span class="pre">assay</span></code> are loaded on Pandas DataFrames
objects</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">collar</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">survey</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">assay</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt; &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt; &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
</pre></div>
</div>
<p>You can see the columns types and plot the tables as follow:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">collar</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">BHID</span>        <span class="nb">object</span>
<span class="n">XCOLLAR</span>    <span class="n">float64</span>
<span class="n">YCOLLAR</span>    <span class="n">float64</span>
<span class="n">ZCOLLAR</span>    <span class="n">float64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">collar</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BHID</th>
      <th>XCOLLAR</th>
      <th>YCOLLAR</th>
      <th>ZCOLLAR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>34873</td>
      <td>2296021.09</td>
      <td>414095.85</td>
      <td>1590.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B1-001</td>
      <td>2294148.20</td>
      <td>420495.90</td>
      <td>1620.9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B1-002</td>
      <td>2296769.50</td>
      <td>422333.50</td>
      <td>1553.0</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">survey</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BHID</th>
      <th>AT</th>
      <th>AZ</th>
      <th>DIP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>34873</td>
      <td>0.0</td>
      <td>0</td>
      <td>90.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B1-001</td>
      <td>0.0</td>
      <td>327</td>
      <td>60.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>B1-002</td>
      <td>0.0</td>
      <td>327</td>
      <td>60.0</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">assay</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BHID</th>
      <th>FROM</th>
      <th>TO</th>
      <th>CU</th>
      <th>NI</th>
      <th>S</th>
      <th>FE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>34873</td>
      <td>0.0</td>
      <td>2515.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>34873</td>
      <td>2515.0</td>
      <td>2517.4</td>
      <td>0.03</td>
      <td>0.08</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>34873</td>
      <td>2517.4</td>
      <td>2518.9</td>
      <td>0.04</td>
      <td>0.10</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div><p>Pandas provides a large set of functions to modify your data. Lets
remove some columns and make non-assayed intervals equal to zero.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># droping some columns</span>
<span class="n">assay</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;NI&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;FE&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># making non-sampled intervals equal to zero</span>
<span class="n">assay</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">assay</span><span class="p">[</span><span class="s1">&#39;CU&#39;</span><span class="p">]),</span> <span class="s1">&#39;CU&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-drillhole-object">
<h2>Creating drillhole object<a class="headerlink" href="#creating-drillhole-object" title="Permalink to this headline">¶</a></h2>
<p>To get access to the drillhole functions implemented in PyGSLIB, such as
desurvey and compositing, you need to create a drillhole object (an
instance of the class <code class="docutils literal"><span class="pre">Drillhole</span></code>, defined on the submodule
<code class="docutils literal"><span class="pre">gslib.drillhole</span></code>)</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#creating a drillhole object</span>
<span class="n">mydholedb</span><span class="o">=</span><span class="n">pygslib</span><span class="o">.</span><span class="n">drillhole</span><span class="o">.</span><span class="n">Drillhole</span><span class="p">(</span><span class="n">collar</span><span class="o">=</span><span class="n">collar</span><span class="p">,</span> <span class="n">survey</span><span class="o">=</span><span class="n">survey</span><span class="p">)</span>

<span class="c1"># now you can add as many interval tables as you want, for example, assays, lithology and RQD.</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">addtable</span><span class="p">(</span><span class="n">assay</span><span class="p">,</span> <span class="s1">&#39;assay&#39;</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">
C:UsersAdrianAnaconda2libsite-packagesipykernel__main__.py:2: UserWarning: ! Collar table without LENGTH field
  from ipykernel import kernelapp as app
</pre>
<p>The text box above is a warning message. This one is a complain because
the field <code class="docutils literal"><span class="pre">LENGTH</span></code> was not included in the collar table. You will see
similar warnings any time PyGSLIB detects a potential issue in your
data.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># validating a drillhole object</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>
</div>
<pre class="literal-block">
C:UsersAdrianAnaconda2libsite-packagesipykernel__main__.py:2: UserWarning: ! survey with one value at BHID: 34873. This will produce error at desurvey
  from ipykernel import kernelapp as app
C:UsersAdrianAnaconda2libsite-packagesipykernel__main__.py:2: UserWarning: ! survey with one value at BHID: B1-001. This will produce error at desurvey
  from ipykernel import kernelapp as app
</pre>
<p>The warning above is serious. There are drillholes with only one survey record and to desurvey we need at least two records, the first one may be at the collar of the drillhole.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># fixing the issue of single interval at survey table</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">fix_survey_one_interval_err</span><span class="p">(</span><span class="mf">90000.</span><span class="p">)</span>
</pre></div>
</div>
<p>Note: To validate interval tables you may use the function
<code class="docutils literal"><span class="pre">validate_table</span></code>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#validating interval tables</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">validate_table</span><span class="p">(</span><span class="s1">&#39;assay&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="compositing">
<h2>Compositing<a class="headerlink" href="#compositing" title="Permalink to this headline">¶</a></h2>
<p>Before doing any statistical or geostatistical analysis you may verify
that all samples have approximately the same length. If samples have
different lengths you may &#8220;resample&#8221; the drillhole intervals using a
compositing algorithm.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Calculating length of sample intervals</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;assay&#39;</span><span class="p">][</span><span class="s1">&#39;Length&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;assay&#39;</span><span class="p">][</span><span class="s1">&#39;TO&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;assay&#39;</span><span class="p">][</span><span class="s1">&#39;FROM&#39;</span><span class="p">]</span>

<span class="c1"># plotting the interval lengths</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;assay&#39;</span><span class="p">][</span><span class="s1">&#39;Length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># printing length mode</span>
<span class="nb">print</span> <span class="s1">&#39;The Length Mode is:&#39;</span><span class="p">,</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;assay&#39;</span><span class="p">][</span><span class="s1">&#39;Length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">Length</span> <span class="n">Mode</span> <span class="ow">is</span><span class="p">:</span> <span class="mf">10.0</span>
</pre></div>
</div>
<img alt="_images/Tutorial_25_1.png" src="_images/Tutorial_25_1.png" />
<p>Most samples (the mode) are 10 ft. length. This value or any of its
multiples are good options of composite length, they minimize the
oversplitting of sample intervals.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># compositing</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">downh_composite</span><span class="p">(</span><span class="s1">&#39;assay&#39;</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span> <span class="s2">&quot;CU&quot;</span><span class="p">,</span> <span class="n">new_table_name</span><span class="o">=</span> <span class="s2">&quot;CMP&quot;</span><span class="p">,</span>
                          <span class="n">cint</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">minlen</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># first 5 rows of a table</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BHID</th>
      <th>CU</th>
      <th>FROM</th>
      <th>TO</th>
      <th>_acum</th>
      <th>_len</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>54184</th>
      <td>RMC-66313</td>
      <td>0.0</td>
      <td>970.0</td>
      <td>980.0</td>
      <td>0.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>54185</th>
      <td>RMC-66313</td>
      <td>0.0</td>
      <td>980.0</td>
      <td>990.0</td>
      <td>0.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>54186</th>
      <td>RMC-66313</td>
      <td>0.0</td>
      <td>990.0</td>
      <td>1000.0</td>
      <td>0.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>54187</th>
      <td>RMC-66313</td>
      <td>0.0</td>
      <td>1000.0</td>
      <td>1010.0</td>
      <td>0.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>54188</th>
      <td>RMC-66313</td>
      <td>0.0</td>
      <td>1010.0</td>
      <td>1020.0</td>
      <td>0.0</td>
      <td>7.0</td>
    </tr>
  </tbody>
</table>
</div><p>Note that some especial fields were created, those fields have prefix
<code class="docutils literal"><span class="pre">_</span></code>. <code class="docutils literal"><span class="pre">_acum</span></code> is the grade accumulated in the composite interval (sum
of grades from sample intervals contributing to the composite interval)
and <code class="docutils literal"><span class="pre">_len</span></code> is the actual length of the composite.</p>
<p>In the table CMP the interval at row 54188 has <em>FROM : 1010.0</em> and <em>TO:
1020.0</em> but the sample length is only <em>7.0 ft</em>. In this way the <em>FROM</em>
and <em>TO</em> intervals of any drillhole or table are always at the same
position and you can safely use the fields <em>[BHID, FROM]</em> to merge
tables.</p>
</div>
<div class="section" id="desurveying">
<h2>Desurveying<a class="headerlink" href="#desurveying" title="Permalink to this headline">¶</a></h2>
<p>To plot drillholes in 3D or to estimate grade values you need to
calculate the coordinates of the composites. This process is known as
<em>desurvey</em>. There are many techniques to desurvey, PyGSLIB uses minimum
curvature.</p>
<p>Desurvey will add the fields <code class="docutils literal"><span class="pre">azm,</span> <span class="pre">dipm</span></code> and <code class="docutils literal"><span class="pre">xm,</span> <span class="pre">ym,</span> <span class="pre">zm</span></code>, these are
directions and the coordinates at the mid point of composite intervals.
You have the option to add endpoint coordinates <code class="docutils literal"><span class="pre">xb,</span> <span class="pre">yb,</span> <span class="pre">zb</span></code> and
<code class="docutils literal"><span class="pre">xe,</span> <span class="pre">ye,</span> <span class="pre">ze</span></code>, these are required to export drillholes to Paraview (in
vtk format).</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># desurveying an interval table</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">desurvey</span><span class="p">(</span><span class="s1">&#39;CMP&#39;</span><span class="p">,</span><span class="n">warns</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">endpoints</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># first 3 rows of a table</span>
<span class="nb">print</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">
    BHID   CU  FROM    TO  _acum  _len  azm  dipm         xm            ym  0  34873  0.0   0.0  10.0    0.0  10.0  0.0  90.0  2296021.0  414095.84375
1  34873  0.0  10.0  20.0    0.0  10.0  0.0  90.0  2296021.0  414095.84375
2  34873  0.0  20.0  30.0    0.0  10.0  0.0  90.0  2296021.0  414095.84375

       zm         xb            yb      zb         xe            ye      ze
0  1585.0  2296021.0  414095.84375  1590.0  2296021.0  414095.84375  1580.0
1  1575.0  2296021.0  414095.84375  1580.0  2296021.0  414095.84375  1570.0
2  1565.0  2296021.0  414095.84375  1570.0  2296021.0  414095.84375  1560.0
</pre>
</div>
<div class="section" id="creating-a-bhid-of-type-integer">
<h2>Creating a BHID of type integer<a class="headerlink" href="#creating-a-bhid-of-type-integer" title="Permalink to this headline">¶</a></h2>
<p>The compiled FORTRAN code of GSLIB is not good with data of type <em>str</em>,
sometimes you need to transform the <em>BHID</em> to type <em>int</em>, for example,
if you use a maximum number of samples per drillholes on kriging. The
function <code class="docutils literal"><span class="pre">txt2intID</span></code> will do this work for you.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># creating BHID of type integer</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">txt2intID</span><span class="p">(</span><span class="s1">&#39;CMP&#39;</span><span class="p">)</span>

<span class="c1"># first 3 rows of a subtable</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][[</span><span class="s1">&#39;BHID&#39;</span><span class="p">,</span> <span class="s1">&#39;BHIDint&#39;</span><span class="p">,</span> <span class="s1">&#39;FROM&#39;</span><span class="p">,</span> <span class="s1">&#39;TO&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BHID</th>
      <th>BHIDint</th>
      <th>FROM</th>
      <th>TO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>54186</th>
      <td>RMC-66313</td>
      <td>399</td>
      <td>990.0</td>
      <td>1000.0</td>
    </tr>
    <tr>
      <th>54187</th>
      <td>RMC-66313</td>
      <td>399</td>
      <td>1000.0</td>
      <td>1010.0</td>
    </tr>
    <tr>
      <th>54188</th>
      <td>RMC-66313</td>
      <td>399</td>
      <td>1010.0</td>
      <td>1020.0</td>
    </tr>
  </tbody>
</table>
</div></div>
<div class="section" id="rendering-drillhole-intervals-in-paraview-and-exporting-drillhole-data">
<h2>Rendering drillhole intervals in Paraview and exporting drillhole data<a class="headerlink" href="#rendering-drillhole-intervals-in-paraview-and-exporting-drillhole-data" title="Permalink to this headline">¶</a></h2>
<p>PyGSLIB can export drillhole intervals to VTK. Drag and drop the VTK
file on Paraview to see the drillholes in 3D. For a better image quality
add a <em>tube</em> filter and update the color scale.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># exporting results to VTK</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">export_core_vtk_line</span><span class="p">(</span><span class="s1">&#39;CMP&#39;</span><span class="p">,</span> <span class="s1">&#39;cmp.vtk&#39;</span><span class="p">,</span> <span class="n">nanval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is how it looks in Paraview</p>
<div class="figure">
<img alt="Drillhole 3D view" src="_images/figure1.JPG" />
</div>
<p>Interval tables are stored as a python dictionary of <em>{Table Name :
Pandas Dataframes}</em>. To export data to *.csv format use the Pandas
function <code class="docutils literal"><span class="pre">Dataframe.to_csv</span></code>. You can also export to any other format
supported by Pandas, <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/io.html">this is the list of formats
supported</a>.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># inspecting interval tables in drillhole object</span>
<span class="nb">print</span> <span class="s2">&quot;Table names &quot;</span><span class="p">,</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table_mames</span>
<span class="nb">print</span> <span class="s2">&quot;Tables names&quot;</span><span class="p">,</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="nb">print</span> <span class="s2">&quot;table is    &quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Table</span> <span class="n">names</span>  <span class="p">[</span><span class="s1">&#39;assay&#39;</span><span class="p">,</span> <span class="s1">&#39;CMP&#39;</span><span class="p">]</span>
<span class="n">Tables</span> <span class="n">names</span> <span class="p">[</span><span class="s1">&#39;assay&#39;</span><span class="p">,</span> <span class="s1">&#39;CMP&#39;</span><span class="p">]</span>
<span class="n">table</span> <span class="ow">is</span>     <span class="o">&lt;</span><span class="nb">type</span> <span class="s1">&#39;dict&#39;</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># exporting to csv</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;cmp.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tagging-samples-with-domain-code">
<h2>Tagging samples with domain code<a class="headerlink" href="#tagging-samples-with-domain-code" title="Permalink to this headline">¶</a></h2>
<p>Use the function <code class="docutils literal"><span class="pre">pygslib.vtktools.pointinsolid</span></code> to label
composites in a domain defined by a closed wireframe. You can
also use this function to label samples in open surfaces (ej. between two
surfaces), below a surface and above a surface.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># importing the a wireframe</span>
<span class="n">domain</span><span class="o">=</span><span class="n">pygslib</span><span class="o">.</span><span class="n">vtktools</span><span class="o">.</span><span class="n">loadSTL</span><span class="p">(</span><span class="s1">&#39;domain.stl&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Only Stereo Lithography (*.STL) and XML VTK Polydata (VTP) file formats
are implemented. If your data is in a different format, ej. DXF, you can
use a file format converter, my favorite is
<a class="reference external" href="http://www.patrickmin.com/meshconv">meshconv</a></p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># creating array to tag samples in domain1</span>
<span class="n">inside1</span><span class="o">=</span><span class="n">pygslib</span><span class="o">.</span><span class="n">vtktools</span><span class="o">.</span><span class="n">pointinsolid</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span>
                       <span class="n">x</span><span class="o">=</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;xm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                       <span class="n">y</span><span class="o">=</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;ym&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                       <span class="n">z</span><span class="o">=</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;zm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1"># creating a new domain field</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">inside1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># first 3 rows of a subtable</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][[</span><span class="s1">&#39;BHID&#39;</span><span class="p">,</span> <span class="s1">&#39;FROM&#39;</span><span class="p">,</span> <span class="s1">&#39;TO&#39;</span><span class="p">,</span> <span class="s1">&#39;Domain&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>BHID</th>
      <th>FROM</th>
      <th>TO</th>
      <th>Domain</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>34873</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>34873</td>
      <td>10.0</td>
      <td>20.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>34873</td>
      <td>20.0</td>
      <td>30.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># exporting results to VTK</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">export_core_vtk_line</span><span class="p">(</span><span class="s1">&#39;CMP&#39;</span><span class="p">,</span> <span class="s1">&#39;cmp.vtk&#39;</span><span class="p">,</span> <span class="n">nanval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Generated with PyGSLIB&#39;</span><span class="p">)</span>

<span class="c1"># exporting to csv</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;cmp.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>A section of the wireframe and the drillholes may look as follows</p>
<div class="figure">
<img alt="Drillhole tagging" src="_images/figure4.JPG" />
</div>
</div>
<div class="section" id="block-modeling">
<h2>Block modeling<a class="headerlink" href="#block-modeling" title="Permalink to this headline">¶</a></h2>
<p>Cu grades will be estimated on blocks inside the mineralized domain. To
create those blocks you may:</p>
<ul class="simple">
<li>create a block model object <code class="docutils literal"><span class="pre">pygslib.blockmodel.Blockmodel</span></code></li>
<li>fill the mineralized domain with blocks</li>
</ul>
<p>In PyGSLIB we use percent blocks, similar to GEMS ®. In the future we
will implement subcell style, similar to Surpac ®, using Adaptive Mesh
Refinement (AMR).</p>
<p>Blocks are stored in the class member <code class="docutils literal"><span class="pre">bmtable</span></code>, this is a Pandas
DataFrame with especial field index <code class="docutils literal"><span class="pre">IJK</span></code> or <code class="docutils literal"><span class="pre">[IX,IY,IZ]</span></code> and
coordinates <code class="docutils literal"><span class="pre">[XC,</span> <span class="pre">YC,</span> <span class="pre">ZC]</span></code>. We use GSLIB order, in other words,
<code class="docutils literal"><span class="pre">IJK</span></code> is the equivalent of the row number in a GSLIB grid.</p>
<p>Block model tables can be full or partial (with some missing blocks).
Only one table will be available in a block model object.</p>
<p>The block model definition is stored in the members
<code class="docutils literal"><span class="pre">nx,</span> <span class="pre">ny,</span> <span class="pre">nz,</span> <span class="pre">xorg,</span> <span class="pre">yorg,</span> <span class="pre">zorg,</span> <span class="pre">dx,</span> <span class="pre">dy,</span> <span class="pre">dz</span></code>. The origin
<code class="docutils literal"><span class="pre">xorg,</span> <span class="pre">yorg,</span> <span class="pre">zorg</span></code> refers to the lower left corner of the lower left
block (not the centroid), like in Datamine Studio ®.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># The model definition</span>
<span class="n">xorg</span> <span class="o">=</span> <span class="mi">2288230</span>
<span class="n">yorg</span> <span class="o">=</span> <span class="mi">415200</span>
<span class="n">zorg</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dy</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dz</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">160</span>
<span class="n">ny</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">nz</span> <span class="o">=</span> <span class="mi">90</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Creating an empty block model</span>
<span class="n">mymodel</span><span class="o">=</span><span class="n">pygslib</span><span class="o">.</span><span class="n">blockmodel</span><span class="o">.</span><span class="n">Blockmodel</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">,</span><span class="n">nz</span><span class="p">,</span><span class="n">xorg</span><span class="p">,</span><span class="n">yorg</span><span class="p">,</span><span class="n">zorg</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># filling wireframe with blocks</span>
<span class="n">mymodel</span><span class="o">.</span><span class="n">fillwireframe</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>

<span class="c1"># the fillwireframe function generates a field named  __in,</span>
<span class="c1"># this is the proportion inside the wireframe. Here we rename __in to D1</span>
<span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;__in&#39;</span><span class="p">:</span> <span class="s1">&#39;D1&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># creating a partial model by filtering out blocks with zero proportion inside the solid</span>
<span class="n">mymodel</span><span class="o">.</span><span class="n">set_blocks</span><span class="p">(</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">]</span><span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># export partial model to a VTK unstructured grid (*.vtu)</span>
<span class="n">mymodel</span><span class="o">.</span><span class="n">blocks2vtkUnstructuredGrid</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;model.vtu&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">fillwireframe</span></code> created or overwrited <code class="docutils literal"><span class="pre">mymodel.bmtable</span></code>.
The blocks outside the wireframe where filtered out and the final output
is a partial model with block inside or touching the wireframe domain.</p>
<p>Note that <code class="docutils literal"><span class="pre">fillwireframe</span></code> works with closed surfaces only.</p>
<p>A section view of the blocks colored by percentage inside the solid and
the wireframe (white lines) may look as follows:</p>
<div class="figure">
<img alt="block model percentage" src="_images/figure3.JPG" />
</div>
</div>
<div class="section" id="some-basic-stats">
<h2>Some basic stats<a class="headerlink" href="#some-basic-stats" title="Permalink to this headline">¶</a></h2>
<p>You may spend some time doing exploratory data analysis, looking at
statistical plots, 3D views and 2D sections of your data. A good
comersial software for this is <a class="reference external" href="http://opengeostat.com/software-solutions/">Supervisor
®</a>, open source options
are Pandas, <a class="reference external" href="http://statsmodels.sourceforge.net/">Statsmodels</a>,
<a class="reference external" href="https://stanford.edu/~mwaskom/software/seaborn/">Seaborn</a> and
<a class="reference external" href="http://glueviz.org/en/stable/">glueviz</a>.</p>
<p>PyGSLIB includes some minimum functionality for statistical plots and
calculations, with support for declustering wight. Here we demonstrate
how you can do a declustering analysis of the samples in the mineralized
domain and how to evaluate the declustered mean. The declustered mean
will be compared later with the mean of CU estimates.</p>
<p>Note: In this section we are not including all the statistical analysis
usually required for resource estimation.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#declustering parameters</span>
<span class="n">parameters_declus</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;x&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;xm&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ym&#39;</span><span class="p">],</span>
        <span class="s1">&#39;z&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;zm&#39;</span><span class="p">],</span>
        <span class="s1">&#39;vr&#39;</span>     <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;CU&#39;</span><span class="p">],</span>
        <span class="s1">&#39;anisy&#39;</span>  <span class="p">:</span>  <span class="mf">1.</span><span class="p">,</span>
        <span class="s1">&#39;anisz&#39;</span>  <span class="p">:</span>  <span class="mf">0.05</span><span class="p">,</span>
        <span class="s1">&#39;minmax&#39;</span> <span class="p">:</span>  <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;ncell&#39;</span>  <span class="p">:</span>  <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;cmin&#39;</span>   <span class="p">:</span>  <span class="mf">100.</span><span class="p">,</span>
        <span class="s1">&#39;cmax&#39;</span>   <span class="p">:</span>  <span class="mf">5000.</span><span class="p">,</span>
        <span class="s1">&#39;noff&#39;</span>   <span class="p">:</span>  <span class="mi">8</span><span class="p">,</span>
        <span class="s1">&#39;maxcel&#39;</span> <span class="p">:</span>  <span class="o">-</span><span class="mi">1</span><span class="p">}</span>

<span class="c1"># declustering</span>
<span class="n">wtopt</span><span class="p">,</span><span class="n">vrop</span><span class="p">,</span><span class="n">wtmin</span><span class="p">,</span><span class="n">wtmax</span><span class="p">,</span><span class="n">error</span><span class="p">,</span> \
<span class="n">xinc</span><span class="p">,</span><span class="n">yinc</span><span class="p">,</span><span class="n">zinc</span><span class="p">,</span><span class="n">rxcs</span><span class="p">,</span><span class="n">rycs</span><span class="p">,</span><span class="n">rzcs</span><span class="p">,</span><span class="n">rvrcr</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">declus</span><span class="p">(</span><span class="n">parameters_declus</span><span class="p">)</span>

<span class="c1">#Plotting declustering optimization results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">rxcs</span><span class="p">,</span> <span class="n">rvrcr</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X cell size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;declustered mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">rycs</span><span class="p">,</span> <span class="n">rvrcr</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Y cell size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;declustered mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">rzcs</span><span class="p">,</span> <span class="n">rvrcr</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Z cell size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;declustered mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Tutorial_53_0.png" src="_images/Tutorial_53_0.png" />
<img alt="_images/Tutorial_53_1.png" src="_images/Tutorial_53_1.png" />
<img alt="_images/Tutorial_53_2.png" src="_images/Tutorial_53_2.png" />
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># parameters for declustering with the cell size selected</span>
<span class="n">parameters_declus</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;x&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;xm&#39;</span><span class="p">],</span>
        <span class="s1">&#39;y&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;ym&#39;</span><span class="p">],</span>
        <span class="s1">&#39;z&#39;</span>      <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;zm&#39;</span><span class="p">],</span>
        <span class="s1">&#39;vr&#39;</span>     <span class="p">:</span>  <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;CU&#39;</span><span class="p">],</span>
        <span class="s1">&#39;anisy&#39;</span>  <span class="p">:</span>  <span class="mf">1.</span><span class="p">,</span>    <span class="c1"># y == x</span>
        <span class="s1">&#39;anisz&#39;</span>  <span class="p">:</span>  <span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># z = x/20</span>
        <span class="s1">&#39;minmax&#39;</span> <span class="p">:</span>  <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;ncell&#39;</span>  <span class="p">:</span>  <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;cmin&#39;</span>   <span class="p">:</span>  <span class="mf">1000.</span><span class="p">,</span>
        <span class="s1">&#39;cmax&#39;</span>   <span class="p">:</span>  <span class="mf">1000.</span><span class="p">,</span>
        <span class="s1">&#39;noff&#39;</span>   <span class="p">:</span>  <span class="mi">8</span><span class="p">,</span>
        <span class="s1">&#39;maxcel&#39;</span> <span class="p">:</span>  <span class="o">-</span><span class="mi">1</span><span class="p">}</span>


<span class="c1"># declustering</span>
<span class="n">wtopt</span><span class="p">,</span><span class="n">vrop</span><span class="p">,</span><span class="n">wtmin</span><span class="p">,</span><span class="n">wtmax</span><span class="p">,</span><span class="n">error</span><span class="p">,</span> \
<span class="n">xinc</span><span class="p">,</span><span class="n">yinc</span><span class="p">,</span><span class="n">zinc</span><span class="p">,</span><span class="n">rxcs</span><span class="p">,</span><span class="n">rycs</span><span class="p">,</span><span class="n">rzcs</span><span class="p">,</span><span class="n">rvrcr</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">declus</span><span class="p">(</span><span class="n">parameters_declus</span><span class="p">)</span>

<span class="c1"># Adding declustering weight to a drillhole interval table</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;declustwt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s1">&#39;CMP&#39;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;declustwt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wtopt</span>

<span class="c1"># calculating declustered mean</span>
<span class="n">decl_mean</span> <span class="o">=</span> <span class="n">rvrcr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="estimating-cu-grade-in-one-block">
<h2>Estimating Cu grade in one block<a class="headerlink" href="#estimating-cu-grade-in-one-block" title="Permalink to this headline">¶</a></h2>
<p>For estimation you may use the function <code class="docutils literal"><span class="pre">pygslib.gslib.kt3d</span></code>, which is
the GSLIB&#8217;s KT3D program modified and embedded into python. KT3D now
includes a maximum number of samples per drillhole in the search
ellipsoid and the estimation is only in the blocks provided as arrays.</p>
<p>The input parameters of <code class="docutils literal"><span class="pre">pygslib.gslib.kt3d</span></code> are defined in a large
and complicated dictionary. You can get this dictionary by typing</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">kt3d</span><span class="o">.</span><span class="n">__doc__</span>
</pre></div>
</div>
<p>Note that some parameters are optional. PyGSLIB will initialize those
parameters to zero or to array of zeros, for example if you exclude the
coordinate Z, PyGSLIB will create an array of zeros in its place.</p>
<p>To understand GSLIB&#8217;s KT3D parameters you may read the <a class="reference external" href="https://www.amazon.ca/GSLIB-Geostatistical-Software-Library-Users/dp/0195100158">GSLIB user
manual</a>
or <a class="reference external" href="http://www.statios.com/help/kt3d.html">the kt3d gslib program parameter
documentation</a>.</p>
<p>Note that in PyGSLIB the parameters nx, ny and nz are only used by
superblock search algorithm, if these parameters are arbitrary the
output will be correct but the running time may be longer.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># creating parameter dictionary for estimation in one block</span>
<span class="n">kt3d_Parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># Input Data (Only using intervals in the mineralized domain)</span>
            <span class="c1"># ----------</span>
            <span class="s1">&#39;x&#39;</span> <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;xm&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;y&#39;</span> <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;ym&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;z&#39;</span> <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;zm&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;vr&#39;</span> <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;CU&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;bhid&#39;</span> <span class="p">:</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;BHIDint&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="c1"># an integer BHID</span>
            <span class="c1"># Output (Target)</span>
            <span class="c1"># ----------</span>
            <span class="s1">&#39;nx&#39;</span> <span class="p">:</span> <span class="n">nx</span><span class="p">,</span>
            <span class="s1">&#39;ny&#39;</span> <span class="p">:</span> <span class="n">ny</span><span class="p">,</span>
            <span class="s1">&#39;nz&#39;</span> <span class="p">:</span> <span class="n">nz</span><span class="p">,</span>
            <span class="s1">&#39;xmn&#39;</span> <span class="p">:</span> <span class="n">xorg</span><span class="p">,</span>
            <span class="s1">&#39;ymn&#39;</span> <span class="p">:</span> <span class="n">yorg</span><span class="p">,</span>
            <span class="s1">&#39;zmn&#39;</span> <span class="p">:</span> <span class="n">zorg</span><span class="p">,</span>
            <span class="s1">&#39;xsiz&#39;</span> <span class="p">:</span> <span class="n">dx</span><span class="p">,</span>
            <span class="s1">&#39;ysiz&#39;</span> <span class="p">:</span> <span class="n">dy</span><span class="p">,</span>
            <span class="s1">&#39;zsiz&#39;</span> <span class="p">:</span> <span class="n">dz</span><span class="p">,</span>
            <span class="s1">&#39;nxdis&#39;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;nydis&#39;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;nzdis&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;outx&#39;</span> <span class="p">:</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;XC&#39;</span><span class="p">][</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;IJK&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1149229</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>  <span class="c1"># filter to estimate only on block with IJK 1149229</span>
            <span class="s1">&#39;outy&#39;</span> <span class="p">:</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;YC&#39;</span><span class="p">][</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;IJK&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1149229</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;outz&#39;</span> <span class="p">:</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;ZC&#39;</span><span class="p">][</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;IJK&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1149229</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="c1"># Search parameters</span>
            <span class="c1"># ----------</span>
            <span class="s1">&#39;radius&#39;</span>     <span class="p">:</span> <span class="mi">850</span><span class="p">,</span>
            <span class="s1">&#39;radius1&#39;</span>    <span class="p">:</span> <span class="mi">850</span><span class="p">,</span>
            <span class="s1">&#39;radius2&#39;</span>    <span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
            <span class="s1">&#39;sang1&#39;</span>      <span class="p">:</span> <span class="o">-</span><span class="mi">28</span><span class="p">,</span>
            <span class="s1">&#39;sang2&#39;</span>      <span class="p">:</span> <span class="mi">34</span><span class="p">,</span>
            <span class="s1">&#39;sang3&#39;</span>      <span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
            <span class="s1">&#39;ndmax&#39;</span>      <span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
            <span class="s1">&#39;ndmin&#39;</span>      <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;noct&#39;</span>       <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;nbhid&#39;</span>      <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="c1"># Kriging parameters and options</span>
            <span class="c1"># ----------</span>
            <span class="s1">&#39;ktype&#39;</span>      <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>   <span class="c1"># 1 Ordinary kriging</span>
            <span class="s1">&#39;idbg&#39;</span>       <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>   <span class="c1"># 0 no debug</span>
            <span class="c1"># Variogram parameters</span>
            <span class="c1"># ----------</span>
            <span class="s1">&#39;c0&#39;</span>         <span class="p">:</span> <span class="mf">0.35</span><span class="p">,</span>
            <span class="s1">&#39;it&#39;</span>         <span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
            <span class="s1">&#39;cc&#39;</span>         <span class="p">:</span> <span class="p">[</span><span class="mf">0.41</span><span class="p">,</span><span class="mf">0.23</span><span class="p">],</span>
            <span class="s1">&#39;aa&#39;</span>         <span class="p">:</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span><span class="mi">1117</span><span class="p">],</span>
            <span class="s1">&#39;aa1&#39;</span>        <span class="p">:</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span><span class="mi">1117</span><span class="p">],</span>
            <span class="s1">&#39;aa2&#39;</span>        <span class="p">:</span> <span class="p">[</span><span class="mi">96</span><span class="p">,</span><span class="mi">300</span><span class="p">],</span>
            <span class="s1">&#39;ang1&#39;</span>       <span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">28</span><span class="p">,</span><span class="o">-</span><span class="mi">28</span><span class="p">],</span>
            <span class="s1">&#39;ang2&#39;</span>       <span class="p">:</span> <span class="p">[</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">34</span><span class="p">],</span>
            <span class="s1">&#39;ang3&#39;</span>       <span class="p">:</span> <span class="p">[</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">7</span><span class="p">]}</span>
</pre></div>
</div>
<p>The variogram model was modeled with <a class="reference external" href="http://opengeostat.com/software-solutions/">Supervisor
®</a>.</p>
<div class="figure">
<img alt="Variograms" src="_images/figure5.JPG" />
</div>
<p>The variogram types are as explained in
<a class="reference external" href="http://www.gslib.com/gslib_help/vmtype.html">http://www.gslib.com/gslib_help/vmtype.html</a>, for example,
<code class="docutils literal"><span class="pre">'it'</span> <span class="pre">:</span> <span class="pre">[2,2]</span></code> means two exponential models, in other words
<code class="docutils literal"><span class="pre">[Exponential</span> <span class="pre">1,Exponential</span> <span class="pre">2]</span></code></p>
<p>Only the block with index <em>IJK</em> equal to 1149229 was used this time and
<code class="docutils literal"><span class="pre">'idbg'</span></code> was set to one in order to get a full output of the last (and
unique) block estimate, including the samples selected, kriging weight
and the search ellipsoid.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># estimating in one block</span>
<span class="n">estimate</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">kt3d</span><span class="p">(</span><span class="n">kt3d_Parameters</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/Tutorial_58_0.png" src="_images/Tutorial_58_0.png" />
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1">#saving debug to a csv file using Pandas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span><span class="n">debug</span><span class="p">[</span><span class="s1">&#39;dbgxdat&#39;</span><span class="p">],</span><span class="s1">&#39;y&#39;</span><span class="p">:</span><span class="n">debug</span><span class="p">[</span><span class="s1">&#39;dbgydat&#39;</span><span class="p">],</span><span class="s1">&#39;z&#39;</span><span class="p">:</span><span class="n">debug</span><span class="p">[</span><span class="s1">&#39;dbgzdat&#39;</span><span class="p">],</span><span class="s1">&#39;wt&#39;</span><span class="p">:</span><span class="n">debug</span><span class="p">[</span><span class="s1">&#39;dbgwt&#39;</span><span class="p">]})</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dbg_data.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#pd.DataFrame({&#39;x&#39;:[debug[&#39;dbgxtg&#39;]],&#39;y&#39;:[debug[&#39;dbgytg&#39;]],&#39;z&#39;:[debug[&#39;dbgztg&#39;]],&#39;na&#39;:[debug[&#39;na&#39;]]}).to_csv(&#39;dbg_target.csv&#39;, index=False)</span>

<span class="c1"># save the search ellipse to a VTK file</span>
<span class="n">pygslib</span><span class="o">.</span><span class="n">vtktools</span><span class="o">.</span><span class="n">SavePolydata</span><span class="p">(</span><span class="n">debug</span><span class="p">[</span><span class="s1">&#39;ellipsoid&#39;</span><span class="p">],</span> <span class="s1">&#39;search_ellipsoid&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The result may look like this in Paraview.</p>
<div class="figure">
<img alt="Ellipsoid" src="_images/figure6.JPG" />
</div>
</div>
<div class="section" id="estimating-in-all-blocks">
<h2>Estimating in all blocks<a class="headerlink" href="#estimating-in-all-blocks" title="Permalink to this headline">¶</a></h2>
<p>After testing the estimation parameters in few blocks you may be ready
to estimate in all the blocks within the mineralized domain. Just update
the parameter file to remove the debug option and reassign the target
coordinates as the actual blocks coordinate arrays.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># update parameter file</span>
<span class="n">kt3d_Parameters</span><span class="p">[</span><span class="s1">&#39;idbg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># set the debug of</span>
<span class="n">kt3d_Parameters</span><span class="p">[</span><span class="s1">&#39;outx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;XC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># use all the blocks</span>
<span class="n">kt3d_Parameters</span><span class="p">[</span><span class="s1">&#39;outy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;YC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">kt3d_Parameters</span><span class="p">[</span><span class="s1">&#39;outz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;ZC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># estimating in all blocks</span>
<span class="n">estimate</span><span class="p">,</span> <span class="n">debug</span><span class="p">,</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">pygslib</span><span class="o">.</span><span class="n">gslib</span><span class="o">.</span><span class="n">kt3d</span><span class="p">(</span><span class="n">kt3d_Parameters</span><span class="p">)</span>

<span class="c1"># adding the estimate into the model</span>
<span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">estimate</span><span class="p">[</span><span class="s1">&#39;outest&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># exporting block model to VTK (unstructured grid)</span>
<span class="n">mymodel</span><span class="o">.</span><span class="n">blocks2vtkUnstructuredGrid</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;model.vtu&#39;</span><span class="p">)</span>

<span class="c1"># exporting to csv using Pandas</span>
<span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">=</span> <span class="mi">1</span>
<span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;model.csv&#39;</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="validating-the-results">
<h2>Validating the results<a class="headerlink" href="#validating-the-results" title="Permalink to this headline">¶</a></h2>
<p>There are few validations you may do:</p>
<ul class="simple">
<li>visual validation</li>
<li>comparison of mean grade</li>
<li>swath plots</li>
<li>global change of support (GCOS)</li>
</ul>
<p>Swath plots and GCOS are not implemented in PyGSLIB. For visual
validations you can use Paraview, for example:</p>
<div class="figure">
<img alt="Visual validation" src="_images/figure7.JPG" />
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="s2">&quot;Mean in model   :&quot;</span><span class="p">,</span>  <span class="n">mymodel</span><span class="o">.</span><span class="n">bmtable</span><span class="p">[</span><span class="s1">&#39;CU_OK&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span> <span class="s2">&quot;Mean in data    :&quot;</span><span class="p">,</span> <span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;CU&#39;</span><span class="p">][</span><span class="n">mydholedb</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;CMP&quot;</span><span class="p">][</span><span class="s1">&#39;Domain&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="nb">print</span> <span class="s2">&quot;Declustered mean:&quot;</span><span class="p">,</span> <span class="n">decl_mean</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Mean</span> <span class="ow">in</span> <span class="n">model</span>   <span class="p">:</span> <span class="mf">0.2942070961</span>
<span class="n">Mean</span> <span class="ow">in</span> <span class="n">data</span>    <span class="p">:</span> <span class="mf">0.366458176447</span>
<span class="n">Declustered</span> <span class="n">mean</span><span class="p">:</span> <span class="mf">0.327602770625</span>
</pre></div>
</div>
<p>The swath plots and the global change of support were calculated with
<a class="reference external" href="http://opengeostat.com/software-solutions/">Supervisor ®</a>. These
validation tests show that the model is not good enough.</p>
<p>To fix the estimate you can rerun this Ipython Notebook after changing
the parameters. Repeat the process until the estimate validates
properly.</p>
<div class="figure">
<img alt="Validation in Supervisor" src="_images/figure8.JPG" />
</div>
<p>You may also try to rotate and the data before doing swath plots (use
the function <code class="docutils literal"><span class="pre">pygslib.gslib.rotscale</span></code>). In addition you can try a
different estimator, for example MIK. The IK3D program is not
implemented in PyGSLIB but you can estimate indicators with
<code class="docutils literal"><span class="pre">pygslib.gslib.kt3d</span></code> and post-process it with <code class="docutils literal"><span class="pre">pygslib.gslib.postik</span></code>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="API.html" class="btn btn-neutral float-right" title="PyGSLIB API autogenerated documentation!" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to PyGSLIB documentation!" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Adrian Martinez Vargas.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.0.3.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>